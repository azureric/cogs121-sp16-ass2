<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="Dashboard">
    <meta name="keyword" content="Dashboard, Bootstrap, Admin, Template, Theme, Responsive, Fluid, Retina">

    <!-- Bootstrap core CSS -->
    <link href="assets/css/bootstrap.css" rel="stylesheet">
    <!--external css-->
    <link href="assets/font-awesome/css/font-awesome.css" rel="stylesheet" />
    <link rel="stylesheet" type="text/css" href="assets/css/zabuto_calendar.css">
    <link rel="stylesheet" type="text/css" href="assets/js/gritter/css/jquery.gritter.css" />
    <link rel="stylesheet" type="text/css" href="assets/lineicons/style.css">

    <!-- Custom styles for this template -->
    <link href="assets/css/style.css" rel="stylesheet">
    <link href="assets/css/style-responsive.css" rel="stylesheet">

    <script src="assets/js/chart-master/Chart.js"></script>
    <script src="https://code.jquery.com/jquery-2.1.3.min.js"></script>


    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>
<style>

    .d3chart{
        margin-top: -10px;
        margin-left: 30px;
        margin-right: -30px;
    }

    .node {
        cursor: pointer;
    }

    .node:hover {
        stroke: #000;
        stroke-width: 1.5px;
    }

    .node--leaf {
        fill: white;
    }

    .label {
        font: 15px "Helvetica Neue", Helvetica, Arial, sans-serif;
        font-weight: bold;
        text-anchor: middle;
        text-shadow: 0 1px 0 #fff, 1px 0 0 #fff, -1px 0 0 #fff, 0 -1px 0 #fff;
    }

    .label,
    .node--root{
        pointer-events: none;
    }


/******* Tooltip css ********/
.d3-tip {
  line-height: 1;
  font-weight: bold;
  padding: 12px;
  background: rgba(0, 0, 0, 0.8);
  color: #fff;
  border-radius: 2px;
  z-index: 1005;
}

/* Creates a small triangle extender for the tooltip */
.d3-tip:after {
  box-sizing: border-box;
  display: inline;
  font-size: 10px;
  width: 100%;
  line-height: 1;
  color: rgba(0, 0, 0, 0.8);
  content: "\25BC";
  position: absolute;
  text-align: center;
}

/* Style northward tooltips differently */
.d3-tip.n:after {
  margin: -100px 0 0 0;
  top: 100%;
  left: 0;
  visibility: hidden;
}



</style>
<body>

<section id="container" >
    <!-- **********************************************************************************************************************************************************
    TOP BAR CONTENT & NOTIFICATIONS
    *********************************************************************************************************************************************************** -->
    <!--header start-->
    <header class="header black-bg">
        <div class="sidebar-toggle-box">
        </div>
        <!--logo start-->
        <a class="logo"><b>Crash Vis&mdash;San Diego</b></a>
        <!--logo end-->
        <div class="nav notify-row" id="top_menu">
            <!--  notification start -->
            <!--  notification end -->
        </div>
        <div class="top-menu">
            <ul class="nav pull-right top-menu">
                <li><a class="logout" href="#">Help</a></li>
            </ul>
        </div>

     <script>
      $('.logout').click(function(e) {
        e.preventDefault(); // Prevent the href from redirecting directly
        help("");
      });

      function help(linkURL) {
        swal({
          title: "Data of Motor Vehicle Incidents Visualized", 
          // imageUrl: "assets/img/ui-sam.png"  ,
          text: "This website helps you visualize the number of motor vehicle accidents in San Diego by areas. The graph shows 6 regions in which you can click on to zoom in and explore the individual cities within them. The size of the circle is porportional to the number of incidents of that regions. The bigger the circle is, the more incidents that region or city has encountered. The sidebar on the right of the graph showcases the data of the region or city you select." , 
          confirmButtonText:"I am ready" , 
        }, function() {
          // Redirect the user
          window.location.href = linkURL;
        });
      }
      </script>

    </header>
    <!--header end-->

    <!-- **********************************************************************************************************************************************************
    MAIN SIDEBAR MENU
    *********************************************************************************************************************************************************** -->
    <!--sidebar start-->
    <!--sidebar end-->

    <!-- **********************************************************************************************************************************************************
    MAIN CONTENT
    *********************************************************************************************************************************************************** -->
    <!--main content start-->
    <section id="main-content">
        <section class="wrapper">

            <div class="row">
                <div id="chartArea" class="col-lg-7 main-chart d3chart">




                </div><!-- /col-lg-9 END SECTION MIDDLE -->


                <!-- **********************************************************************************************************************************************************
                RIGHT SIDEBAR CONTENT
                *********************************************************************************************************************************************************** -->

                <div class="col-lg-5 ds">
                    <!--COMPLETED ACTIONS DONUTS CHART-->
                    <h3>MOTOR VEHICLE INJURIES</h3>

                    <div id="userdata"> 
                    </div>
                    
                    <div class="desc">
                        <div class="details" id="welcome" style="width: 100%; text-align: center; margin-left: 0px">
                            <h2>Welcome to Crash Vis!</h2>
                            <h4>Click on any region within the circle to view motor vehicle crash injuries.</h4>
                        </div>
                    </div>
                </div><!-- /col-lg-3 -->
            </div><!--/row -->
        </section>
    </section>

    <!--main content end-->
    <!--footer start-->
    <footer class="site-footer">
        <div class="text-center">
            2016 - COGS121 - Assignment 2 - Chen Yang, Nicole Wong, Bonnie Chinh , Anjelica Thang, Joseph Martin
    
        </div>
    </footer>
    <!--footer end-->
</section>

<!-- js placed at the end of the document so the pages load faster -->
<script src="assets/js/jquery.js"></script>
<script src="assets/js/jquery-1.8.3.min.js"></script>
<script src="assets/js/bootstrap.min.js"></script>
<script class="include" type="text/javascript" src="assets/js/jquery.dcjqaccordion.2.7.js"></script>
<script src="assets/js/jquery.scrollTo.min.js"></script>
<script src="assets/js/jquery.nicescroll.js" type="text/javascript"></script>
<script src="assets/js/jquery.sparkline.js"></script>


<!--common script for all pages-->
<script src="assets/js/common-scripts.js"></script>

<script type="text/javascript" src="assets/js/gritter/js/jquery.gritter.js"></script>
<script type="text/javascript" src="assets/js/gritter-conf.js"></script>

<!--script for this page-->
<script src="assets/js/sparkline-chart.js"></script>
<script src="assets/js/zabuto_calendar.js"></script>

<script src="assets/sweetalert/dist/sweetalert.min.js"></script> <link rel="stylesheet" type="text/css" href="assets/sweetalert/dist/sweetalert.css">
<script async defer
  src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDXW7lc4EsckmB2NLXAWhYqrY5cLxz-jDM&callback=initMap">
</script>
<!-- <script src="/assets/js/googleMaps.js"></script> -->

<script type="text/javascript">

    $(document).ready(function () {
        var unique_id = $.gritter.add({
            // (string | mandatory) the heading of the notification
            title: 'Welcome to Crash Vis!',
            // (string | mandatory) the text inside the notification
            text: 'Click on the circle to expand the regions and learn more.',
            // (string | optional) the image to display on the left
            image: 'assets/img/ui-sam.png',
            // (bool | optional) if you want it to fade out on its own or just sit there
            sticky: true,
            // (int | optional) the time you want it to be alive for before fading out
            time: '',
            // (string | optional) the class name you want to apply to that specific message
            class_name: 'my-sticky-class'
        });

        return false;
    });
</script>

<script type="application/javascript">
    $(document).ready(function () {
        $("#date-popover").popover({html: true, trigger: "manual"});
        $("#date-popover").hide();
        $("#date-popover").click(function (e) {
            $(this).hide();
        });

        $("#my-calendar").zabuto_calendar({
            action: function () {
                return myDateFunction(this.id, false);
            },
            action_nav: function () {
                return myNavFunction(this.id);
            },
            ajax: {
                url: "show_data.php?action=1",
                modal: true
            },
            legend: [
                {type: "text", label: "Special event", badge: "00"},
                {type: "block", label: "Regular event", }
            ]
        });
    });

    function myNavFunction(id) {
        $("#date-popover").hide();
        var nav = $("#" + id).data("navigation");
        var to = $("#" + id).data("to");
        console.log('nav ' + nav + ' to: ' + to.month + '/' + to.year);
    }
    function renderSideBar(d){
        $("#userdata").empty();
        $("#welcome").empty();
        var regionName = d.name;
        var renderRegion = "<h2 style='text-align: center;'>Region: " + d["name"] + "</h2>";
        $(renderRegion).appendTo("#userdata");

        for (i = 0; i < d["children"].length; i++){
            var data = d["children"][i];
            var renderinfo ="<div class='desc'>" + "<div class='details' style='width:100%;'>" + 
                            "<h4>" + "City: <b>" + data["name"] + "</b></h4>" +
                            "<p>" + "Total Injuries in 2011: <b>" + data["2011InjuryNum"] + "</b></p>" +
                            "<p>" + "Total Injuries in 2010: <b>" + data["2010InjuryNum"] + "</b></p>" + 
                            "<p>" + "Average Injuries 2010-2011: <b>" + (data["2011InjuryNum"]+data["2010InjuryNum"])/2.0 + "</b></p>" + "</div> </div>";
            $(renderinfo).appendTo("#userdata");
        }


    }

</script>
<script src="//d3js.org/d3.v3.min.js"></script>
<script src="http://labratrevenge.com/d3-tip/javascripts/d3.tip.v0.6.3.js"></script>
<script>

    var isInZoom = 0;

    var margin = 1,
            diameter =0.9 * window.innerHeight;

    var color = d3.scale.linear()
            .domain([-1, 5])
            .range(["hsl(152,80%,80%)", "hsl(228,30%,40%)"])
            .interpolate(d3.interpolateHcl);

    var pack = d3.layout.pack()
            .padding(2)
            .size([diameter - margin, diameter - margin])
            .value(function(d) { return d.size; })

    var svg = d3.select("#chartArea").append("svg")
            .attr("width", diameter)
            .attr("height", diameter)
            .append("g")
            .attr("transform", "translate(" + diameter / 2 + "," + diameter / 2 + ")");

    var tip = d3.tip()
      .attr("class", "d3-tip")
      .offset([-10, 0])
      .html(function(d) {
        var totalInjuries = (d["2010InjuryNum"] + d["2011InjuryNum"])/2.0;
        if(isNaN(totalInjuries)) {
          var regionTotal = 0;
          for(var i = 0; i < d.children.length; i++) {
            regionTotal += (d["children"][i]["2010InjuryNum"] + d["children"][i]["2011InjuryNum"])/2.0;
          }
          return "<strong>Total Region Motor Injury: </strong>" + regionTotal;
        }
        return "<strong>Total Motor Injuries: </strong>" + totalInjuries;
      });

svg.call(tip);


    //./js/reference.json
    //res.json
    d3.json("/delphidata", function(error, root) {
        if (error) throw error;

        var focus = root,
                nodes = pack.nodes(root),
                view;

        var circle = svg.selectAll("circle")
            .data(nodes)
            .enter().append("circle")
            .attr("class", function(d) { return d.parent ? d.children ? "node" : "node node--leaf" : "node node--root"; })
            .style("fill", function(d) { return d.children ? color(d.depth) : null; })
            .on("click", function(d) {
                if (focus !== d) {
                    console.log(d);
                    if(d.hasOwnProperty("regionID")){
                        console.log("ON REGION ID!");
                        console.log(d.parent);
                        if(isInZoom == 1){
                            zoom(root);
                            isInZoom = 0;
                        }
                        else{
                            renderSideBar(d.parent);
                            zoom(d.parent), d3.event.stopPropagation();
                            isInZoom = 1;
                        }

                    }
                    else{
                        console.log("OFF REGION ID!");
                        isInZoom = 1;
                        renderSideBar(d);
                        zoom(d), d3.event.stopPropagation();
                    }

                }
            })
            .on("mouseover", tip.show)
            .on("mouseout", tip.hide);


        var text = svg.selectAll("text")
                .data(nodes)
                .enter().append("text")
                .attr("class", "label")
                .style("fill-opacity", function(d) { return d.parent === root ? 1 : 0; })
                .style("display", function(d) { return d.parent === root ? "inline" : "none"; })
                .text(function(d) { return d.name; });

        var node = svg.selectAll("circle,text");

        d3.select("body")
                // .style("background", color(-1))
                .on("click", function() {
                    console.log("zoom root");
                    isInZoom = 0;
                    zoom(root); });

        zoomTo([root.x, root.y, root.r * 2 + margin]);

        function zoom(d) {
            var focus0 = focus; focus = d;

            var transition = d3.transition()
                    .duration(d3.event.altKey ? 7500 : 750)
                    .tween("zoom", function(d) {
                        var i = d3.interpolateZoom(view, [focus.x, focus.y, focus.r * 2 + margin]);
                        return function(t) { zoomTo(i(t)); };
                    });

            transition.selectAll("text")
                    .filter(function(d) { return d.parent === focus || this.style.display === "inline"; })
                    .style("fill-opacity", function(d) { return d.parent === focus ? 1 : 0; })
                    .each("start", function(d) { if (d.parent === focus) this.style.display = "inline"; })
                    .each("end", function(d) { if (d.parent !== focus) this.style.display = "none"; });
        }

        function zoomTo(v) {
            var a = 700;
            var k = diameter / v[2]; view = v;
            node.attr("transform", function(d) { return "translate(" + (d.x - v[0]) * k + "," + (d.y - v[1]) * k + ")"; });

            circle.attr("r", function(d) { return d.r * k; });
        }
    });

    d3.select(self.frameElement).style("height", diameter + "px");
</script>

</body>
</html>
